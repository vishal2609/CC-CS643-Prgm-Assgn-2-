FROM openjdk:8-jdk

# Install necessary tools
RUN mkdir -p /opt && apt-get update && apt-get install -y curl tar unzip && rm -rf /var/lib/apt/lists/*

# Install Hadoop
RUN curl -LO https://downloads.apache.org/hadoop/common/hadoop-3.3.5/hadoop-3.3.5.tar.gz && \
    tar -xzf hadoop-3.3.5.tar.gz -C /opt && \
    ln -s /opt/hadoop-3.3.5 /opt/hadoop && \
    rm hadoop-3.3.5.tar.gz

# Install Spark
RUN curl -LO https://downloads.apache.org/spark/spark-3.3.0/spark-3.3.0-bin-hadoop3-scala2.12.tgz && \
    tar -xzf spark-3.3.0-bin-hadoop3-scala2.12.tgz -C /opt && \
    ln -s /opt/spark-3.3.0-bin-hadoop3-scala2.12 /opt/spark && \
    rm spark-3.3.0-bin-hadoop3-scala2.12.tgz

# Create app folder and copy your JAR
WORKDIR /app
COPY target/wine-ml-spark-1.0-SNAPSHOT.jar /app/app.jar

# Default command
ENTRYPOINT ["/opt/spark/bin/spark-submit", "--class", "com.wine.WinePredictApp", "--master", "yarn", "/app/app.jar"]
